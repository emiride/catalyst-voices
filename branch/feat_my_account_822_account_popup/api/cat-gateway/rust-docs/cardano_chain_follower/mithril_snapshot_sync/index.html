<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Internal Mithril snapshot downloader task."><title>cardano_chain_follower::mithril_snapshot_sync - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-492a78a4a87dcc01.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="cardano_chain_follower" data-themes="" data-resource-suffix="" data-rustdoc-version="1.82.0-nightly (0d634185d 2024-08-29)" data-channel="nightly" data-search-js="search-acd2e111c9cb27e3.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-cb0df477c2d67d00.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-3b12f09e550e0385.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../cardano_chain_follower/index.html">cardano_<wbr>chain_<wbr>follower</a><span class="version">0.0.2</span></h2></div><h2 class="location"><a href="#">Module mithril_<wbr>snapshot_<wbr>sync</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#macros">Macros</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#functions">Functions</a></li></ul></section><h2><a href="../index.html">In crate cardano_<wbr>chain_<wbr>follower</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">cardano_chain_follower</a>::<wbr><a class="mod" href="#">mithril_snapshot_sync</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../src/cardano_chain_follower/mithril_snapshot_sync.rs.html#1-812">source</a> Â· <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Internal Mithril snapshot downloader task.</p>
<p>This task is responsible for downloading Mithril snapshot files. It downloads the
latest snapshot file and then sleeps until the next snapshot is available.</p>
</div></details><h2 id="macros" class="section-header">Macros<a href="#macros" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="macro" href="macro.next_iteration.html" title="macro cardano_chain_follower::mithril_snapshot_sync::next_iteration">next_<wbr>iteration</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Cleanup the client explicitly and do a new iteration of the loop.</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.SnapshotStatus.html" title="enum cardano_chain_follower::mithril_snapshot_sync::SnapshotStatus">Snapshot<wbr>Status</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Status of checking if we have a new snapshot to get or not.</div></li></ul><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.DOWNLOAD_ERROR_RETRY_DURATION.html" title="constant cardano_chain_follower::mithril_snapshot_sync::DOWNLOAD_ERROR_RETRY_DURATION">DOWNLOA<wbr>D_<wbr>ERRO<wbr>R_<wbr>RETR<wbr>Y_<wbr>DURATION</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">We shouldnâ€™t get errors that need to wait for this, but if we do wait this long.
These errors should be transient if they occur.</div></li><li><div class="item-name"><a class="constant" href="constant.EXPECTED_MITHRIL_UPDATE_CHECK_INTERVAL.html" title="constant cardano_chain_follower::mithril_snapshot_sync::EXPECTED_MITHRIL_UPDATE_CHECK_INTERVAL">EXPECTE<wbr>D_<wbr>MITHRI<wbr>L_<wbr>UPDAT<wbr>E_<wbr>CHEC<wbr>K_<wbr>INTERVAL</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Average Mithril Update is 6 Hrs, so donâ€™t wait longer than 7.</div></li><li><div class="item-name"><a class="constant" href="constant.MAXIMUM_MITHRIL_UPDATE_CHECK_INTERVAL.html" title="constant cardano_chain_follower::mithril_snapshot_sync::MAXIMUM_MITHRIL_UPDATE_CHECK_INTERVAL">MAXIMU<wbr>M_<wbr>MITHRI<wbr>L_<wbr>UPDAT<wbr>E_<wbr>CHEC<wbr>K_<wbr>INTERVAL</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Average Mithril Update is 6 Hrs, so donâ€™t wait longer than 7.</div></li><li><div class="item-name"><a class="constant" href="constant.MINIMUM_MITHRIL_UPDATE_CHECK_DURATION.html" title="constant cardano_chain_follower::mithril_snapshot_sync::MINIMUM_MITHRIL_UPDATE_CHECK_DURATION">MINIMU<wbr>M_<wbr>MITHRI<wbr>L_<wbr>UPDAT<wbr>E_<wbr>CHEC<wbr>K_<wbr>DURATION</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">The minimum duration between checks for a new Mithril Snapshot. (Must be same as
<code>MINIMUM_MITHRIL_UPDATE_CHECK_INTERVAL</code>)</div></li><li><div class="item-name"><a class="constant" href="constant.MINIMUM_MITHRIL_UPDATE_CHECK_INTERVAL.html" title="constant cardano_chain_follower::mithril_snapshot_sync::MINIMUM_MITHRIL_UPDATE_CHECK_INTERVAL">MINIMU<wbr>M_<wbr>MITHRI<wbr>L_<wbr>UPDAT<wbr>E_<wbr>CHEC<wbr>K_<wbr>INTERVAL</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">The minimum duration between checks for a new Mithril Snapshot. (Must be same as
<code>MINIMUM_MITHRIL_UPDATE_CHECK_DURATION</code>)</div></li><li><div class="item-name"><a class="constant" href="constant.MITHRIL_IMMUTABLE_SUB_DIRECTORY.html" title="constant cardano_chain_follower::mithril_snapshot_sync::MITHRIL_IMMUTABLE_SUB_DIRECTORY">MITHRI<wbr>L_<wbr>IMMUTABL<wbr>E_<wbr>SUB_<wbr>DIRECTORY</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Relative Directory for Immutable data within a full mithril snapshot.</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.background_mithril_update.html" title="fn cardano_chain_follower::mithril_snapshot_sync::background_mithril_update">background_<wbr>mithril_<wbr>update</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Handle the background downloading of Mithril snapshots for a given network.
Note: There can ONLY be at most three of these running at any one time.
This is because there can ONLY be one snapshot for each of the three known Cardano
networks.</div></li><li><div class="item-name"><a class="fn" href="fn.background_validate_mithril_snapshot.html" title="fn cardano_chain_follower::mithril_snapshot_sync::background_validate_mithril_snapshot">background_<wbr>validate_<wbr>mithril_<wbr>snapshot</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Start Mithril Validation in the background, and return a handle so we can check when
it finishes.</div></li><li><div class="item-name"><a class="fn" href="fn.calculate_sleep_duration.html" title="fn cardano_chain_follower::mithril_snapshot_sync::calculate_sleep_duration">calculate_<wbr>sleep_<wbr>duration</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Calculate how long we should wait before we check for another Mithril snapshot.</div></li><li><div class="item-name"><a class="fn" href="fn.check_snapshot_to_download.html" title="fn cardano_chain_follower::mithril_snapshot_sync::check_snapshot_to_download">check_<wbr>snapshot_<wbr>to_<wbr>download</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Check if we have a new snapshot to download, and if so, return its details.</div></li><li><div class="item-name"><a class="fn" href="fn.chunk_filename_to_chunk_number.html" title="fn cardano_chain_follower::mithril_snapshot_sync::chunk_filename_to_chunk_number">chunk_<wbr>filename_<wbr>to_<wbr>chunk_<wbr>number</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Convert a chunk filename into its numeric equivalent.</div></li><li><div class="item-name"><a class="fn" href="fn.cleanup.html" title="fn cardano_chain_follower::mithril_snapshot_sync::cleanup">cleanup</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">We can accumulate junk depending on errors or when we terminate, make sure we are
always clean.</div></li><li><div class="item-name"><a class="fn" href="fn.connect_client.html" title="fn cardano_chain_follower::mithril_snapshot_sync::connect_client">connect_<wbr>client</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">This function creates a client based on the given network and genesis vkey.</div></li><li><div class="item-name"><a class="fn" href="fn.create_client.html" title="fn cardano_chain_follower::mithril_snapshot_sync::create_client">create_<wbr>client</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Create a client, should never fail, but return None if it does, because we canâ€™t
continue.</div></li><li><div class="item-name"><a class="fn" href="fn.download_and_validate_snapshot.html" title="fn cardano_chain_follower::mithril_snapshot_sync::download_and_validate_snapshot">download_<wbr>and_<wbr>validate_<wbr>snapshot</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Downloads and validates a snapshot from the aggregator.</div></li><li><div class="item-name"><a class="fn" href="fn.download_and_verify_snapshot_certificate.html" title="fn cardano_chain_follower::mithril_snapshot_sync::download_and_verify_snapshot_certificate">download_<wbr>and_<wbr>verify_<wbr>snapshot_<wbr>certificate</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Download and Verify the Snapshots certificate</div></li><li><div class="item-name"><a class="fn" href="fn.get_latest_snapshots.html" title="fn cardano_chain_follower::mithril_snapshot_sync::get_latest_snapshots">get_<wbr>latest_<wbr>snapshots</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Returns the Latest and chronologically previous snapshots data from the Aggregator.
Will return None if it can not get the Snapshot list, or there are no entries in it.
If there is only a single entry then the latest and chronologically next will be
identical.</div></li><li><div class="item-name"><a class="fn" href="fn.get_latest_validated_mithril_snapshot.html" title="fn cardano_chain_follower::mithril_snapshot_sync::get_latest_validated_mithril_snapshot">get_<wbr>latest_<wbr>validated_<wbr>mithril_<wbr>snapshot</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">See if we have a latest snapshot already, and if so, validate it.</div></li><li><div class="item-name"><a class="fn" href="fn.get_mithril_snapshot_and_certificate.html" title="fn cardano_chain_follower::mithril_snapshot_sync::get_mithril_snapshot_and_certificate">get_<wbr>mithril_<wbr>snapshot_<wbr>and_<wbr>certificate</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Get the Snapshot Data itself from the Aggregator, and a validate Certificate.</div></li><li><div class="item-name"><a class="fn" href="fn.get_mithril_tip.html" title="fn cardano_chain_follower::mithril_snapshot_sync::get_mithril_tip">get_<wbr>mithril_<wbr>tip</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Get the tip block from the Immutable chain, and the block immediately proceeding it.</div></li><li><div class="item-name"><a class="fn" href="fn.get_snapshot.html" title="fn cardano_chain_follower::mithril_snapshot_sync::get_snapshot">get_<wbr>snapshot</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Get the actual snapshot from the specified <code>snapshot_item</code> from the list of snapshots.
Returns None if there are any issues doing this, otherwise the Snapshot.
The only issues should be transient communications errors.</div></li><li><div class="item-name"><a class="fn" href="fn.get_snapshot_by_id.html" title="fn cardano_chain_follower::mithril_snapshot_sync::get_snapshot_by_id">get_<wbr>snapshot_<wbr>by_<wbr>id</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Given a particular snapshot ID, find the Actual Snapshot for it.</div></li><li><div class="item-name"><a class="fn" href="fn.recover_existing_snapshot.html" title="fn cardano_chain_follower::mithril_snapshot_sync::recover_existing_snapshot">recover_<wbr>existing_<wbr>snapshot</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Get the Mithril client and recover our existing mithril snapshot data, if any.</div></li><li><div class="item-name"><a class="fn" href="fn.sleep_until_next_probable_update.html" title="fn cardano_chain_follower::mithril_snapshot_sync::sleep_until_next_probable_update">sleep_<wbr>until_<wbr>next_<wbr>probable_<wbr>update</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Sleep until its likely there has been another mithril snapshot update.</div></li><li><div class="item-name"><a class="fn" href="fn.trim_chunk_list.html" title="fn cardano_chain_follower::mithril_snapshot_sync::trim_chunk_list">trim_<wbr>chunk_<wbr>list</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Remove any chunks from the chunk list which exceed the <code>max_chunk</code>.</div></li><li><div class="item-name"><a class="fn" href="fn.validate_mithril_snapshot.html" title="fn cardano_chain_follower::mithril_snapshot_sync::validate_mithril_snapshot">validate_<wbr>mithril_<wbr>snapshot</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Validate that a Mithril Snapshot downloaded matches its certificate.</div></li></ul></section></div></main></body></html>